(window.webpackJsonp=window.webpackJsonp||[]).push([[331],{789:function(t,a,s){"use strict";s.r(a);var n=s(25),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"redux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redux"}},[t._v("#")]),t._v(" Redux")]),t._v(" "),s("p",[t._v("JS 应用程序的可预测状态容器")]),t._v(" "),s("p",[t._v("​")]),t._v(" "),s("p",[t._v("Redux 是什么？")]),t._v(" "),s("p",[t._v("有什么用？")]),t._v(" "),s("p",[t._v("它的写法")]),t._v(" "),s("h2",{attrs:{id:"起因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#起因"}},[t._v("#")]),t._v(" 起因")]),t._v(" "),s("p",[t._v("我们写React，当页面逻辑不复杂时，我们可以通过state来管理数据")]),t._v(" "),s("p",[t._v("但是当页面逻辑复杂时，Page页面（一个Page就是一个组件）下有 Header组件、Content组件、Footer组件等，Header组件中又有Avatar组件、HeaderTitle组件、HeaderOther组件，Avatar中又有其他的组件，那么你拿到后端传来的数据时，怎么把数据传递给细分后的子孙组件呢？")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://i.loli.net/2021/06/17/buLJOjiKwaWk7Rg.png",alt:"image-20210617105102880"}})]),t._v(" "),s("p",[t._v("通过props让下传？")]),t._v(" "),s("p",[t._v("在这个例子中，Avatar需要获取 avatar的图片资源，需要通过页面请求从后端获取数据。在 Page 组件中获取到数据，存在 state 的 data 中，先把数据传递给 Header 组件，再由 Header 传递给 Avatar。Header 组件用不到 avatarImg，但为了子组件多写了一边。")]),t._v(" "),s("p",[t._v("如果通过 props 的方式传递数据，如果页面一复杂，写的人会写到手抖。")]),t._v(" "),s("p",[t._v("所以有一些大牛开始写一些库，来关联两者之间的关系，最开始是 flux，后来 redux 改进了，成了主流，但是要说明的一点是，")]),t._v(" "),s("p",[t._v("react是用jsx的写法来展示视图，通过state来管理状态")]),t._v(" "),s("p",[t._v("flux、redux、mobx等是针对状态的管理的库，不需要react也可以用，但是它们是因为react而被大众认知并且发扬光大")]),t._v(" "),s("p",[t._v("如果我们要手写一个redux，不需要用到react")]),t._v(" "),s("p",[t._v("而实际开发中，如果我们需要说的react全家桶，包括：react（描述视图的库）、redux（状态管理的库）、react-redux（将react与redux结合在一起的库）")]),t._v(" "),s("p",[t._v("因为这是最常见的，其实说法不准确，应该叫react-redux全家桶。因为如果你用mobx的话，就是这样：react（描述视图的库）、mobx（状态管理的库）、mobx-react（将mobx与react结合在一起的库）")]),t._v(" "),s("p",[t._v("说起来，我们忽略了一直有用到的库：react-dom，它的作用是将用 react 写好的虚拟dom转换成真实dom")]),t._v(" "),s("p",[t._v("发现了没，常规来说，像 react和react-dom是要结合在一起了。为什么要分开，因为用react写好的虚拟dom可以放在其他容器上，比如手机上（react-native）、VR上（react-vr）")]),t._v(" "),s("p",[t._v("像redux最初是为了解决react上的状态管理，结合了react-redux的功能，后来再把它拆开")]),t._v(" "),s("p",[t._v("flux 不表，单单就 redux 来说，如果把每一个状态比作一个村民，村长有一个记录了每一个村民的劳动清单，例如张三——种田，李四——种苹果，王五——种桃子，赵六——打铁，这个清单就是reducer。每次有人过来问，问村长张三是做什么的，村长查了茶名单，告诉那人，张三是种田的。过了几年，有人死了，就来村长这里登记，李四死掉了，村长更新名单。同样的，换职业、新人加入等都要去村长那里登记。这就是redux。")]),t._v(" "),s("p",[t._v("相当于有一个全局的store管理着状态，这里自然而然就有个问题出来，为什么要搞这么麻烦，难道不能直接搞个全局对象，但是全局对象的确定是你可以修改，我也可以修改，毕竟javascript是肉类型，你修改了store中的数据，我都不知道。")]),t._v(" "),s("p",[t._v("所以有人搞出一个库来")]),t._v(" "),s("h3",{attrs:{id:"其言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其言"}},[t._v("#")]),t._v(" 其言")]),t._v(" "),s("p",[t._v("为什么会有redux\n历史\nflux")]),t._v(" "),s("p",[t._v("flux")]),t._v(" "),s("p",[t._v("实现方式： eventEmitter 事件消息模式")]),t._v(" "),s("p",[t._v("监听发布，消息比较乱")]),t._v(" "),s("p",[t._v("reflux")]),t._v(" "),s("p",[t._v("redux 映射表")]),t._v(" "),s("p",[t._v("mobx是一种监听")]),t._v(" "),s("p",[t._v("observable")]),t._v(" "),s("p",[t._v("注入，被观察")]),t._v(" "),s("h3",{attrs:{id:"单向数据流和双向数据流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单向数据流和双向数据流"}},[t._v("#")]),t._v(" 单向数据流和双向数据流")]),t._v(" "),s("p",[t._v("单向数据流和双向数据绑定")]),t._v(" "),s("p",[t._v("表单的双向绑定，说到底不过是value的单向绑定 + onChange事件监听")]),t._v(" "),s("p",[t._v("React本身并不存在所谓的单向数据流，这完全是Flux引入的概念")]),t._v(" "),s("h4",{attrs:{id:"redux笔记"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redux笔记"}},[t._v("#")]),t._v(" redux笔记")]),t._v(" "),s("p",[t._v("reducer 就是为了创建store，翻译：还原剂")]),t._v(" "),s("p",[t._v("createStore // 创建store")]),t._v(" "),s("p",[t._v("comose // 合并store")]),t._v(" "),s("p",[t._v("applyMiddleware // 中间件 redux-thunk 异步")]),t._v(" "),s("p",[t._v("dispatch ：调度，派发")]),t._v(" "),s("p",[t._v("store.dispatch({")]),t._v(" "),s("p",[t._v("​\ttype: 'INCREMENT',")]),t._v(" "),s("p",[t._v("​\tnum: 10")]),t._v(" "),s("p",[t._v("})")]),t._v(" "),s("p",[t._v("先用reducer创建store，reducer是个纯函数，由值（state）和动作指示（action）组成，")]),t._v(" "),s("p",[t._v("store会dispatch发出动作名字和传入的值")]),t._v(" "),s("p",[t._v("action是个返回对象的函数")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("num")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\ttype"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引入constants中的常量")]),t._v("\n\t\t\tnum\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("constants 常量集合")]),t._v(" "),s("p",[t._v("counter 返回的是state")]),t._v(" "),s("p",[t._v("全局一个store")]),t._v(" "),s("p",[t._v("把某一个reducer注册成一个方法，通过action改变方法名的值，最后返回回来又给state，state又通过react的组件props向下传递数据，一层层往下传，哪里用到的话，就用connect插件（装饰器）引用一下就行了")]),t._v(" "),s("p",[t._v("store注册到顶部的props，传递数据")]),t._v(" "),s("p",[t._v("因为一个全局变量在被改变之后无法驱动 react 组件重新渲染")]),t._v(" "),s("p",[t._v("要先有疑惑感？")]),t._v(" "),s("p",[t._v("什么是redux？")]),t._v(" "),s("p",[t._v("​\t因为react的数据不好传递")]),t._v(" "),s("p",[t._v("​\t所以引申出很多技术来解决，redux就是其中一种")]),t._v(" "),s("ul",[s("li",[t._v("store 数据")]),t._v(" "),s("li",[t._v("view 视图")]),t._v(" "),s("li",[t._v("action 动作")]),t._v(" "),s("li",[t._v("reducer 纯函数，你传来什么，我根据你的指示，传回去什么")])]),t._v(" "),s("p",[t._v("我的理解：用户触发各种事件，即 action，派发（dispatch）事件到 reducer，reducer是纯函数，你传来什么，我传回去你要的store，。。。")]),t._v(" "),s("p",[t._v("为什么要用redux？")]),t._v(" "),s("p",[t._v("​\t共享数据")]),t._v(" "),s("p",[t._v("redux有什么用？")]),t._v(" "),s("p",[t._v("​\t单流程")]),t._v(" "),s("p",[t._v("react-redux才是这个作用")]),t._v(" "),s("p",[t._v("​\t能全局控制store（数据），数据能跨组件传递数据（交给redux")]),t._v(" "),s("p",[t._v("源码怎么实现？")]),t._v(" "),s("h3",{attrs:{id:"笔记"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#笔记"}},[t._v("#")]),t._v(" 笔记")]),t._v(" "),s("h3",{attrs:{id:"reducer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reducer"}},[t._v("#")]),t._v(" reducer")]),t._v(" "),s("p",[t._v("什么是 reducer")]),t._v(" "),s("p",[s("strong",[t._v("reducer 就是一个纯函数，接受旧的 state 和 action，返回新的 state")])]),t._v(" "),s("p",[t._v("可以说 reducer 就是定义的规则机制")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("previousState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" newState\n")])])]),s("p",[t._v("例如： 你去银行存钱，存10000元，银行就存10000元，去银行存钱的动作就是action，银行存取钱的规则就是reducer")]),t._v(" "),s("p",[t._v("之所以将这样的函数称之为 reducer，是因为这种函数与被传入"),s("code",[t._v("Array.prototype.reduce(reducer, ?initialValue)")]),t._v(" 里的回调函数属于相同的类型。保持 reducer 纯净非常重要。"),s("strong",[t._v("永远不要")]),t._v("在 reducer 里做这些操作：")]),t._v(" "),s("ul",[s("li",[t._v("修改传入参数；")]),t._v(" "),s("li",[t._v("执行有副作用的操作，如 API 请求和路由跳转；")]),t._v(" "),s("li",[t._v("调用非纯函数，如"),s("code",[t._v("Date.now()")]),t._v(" 或 "),s("code",[t._v("Math.random()")])])]),t._v(" "),s("h3",{attrs:{id:"什么是reduce"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是reduce"}},[t._v("#")]),t._v(" 什么是reduce")]),t._v(" "),s("p",[t._v("案例来自于 "),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" array1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("reducer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("accumulator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" currentValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" accumulator "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" currentValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1 + 2 + 3 + 4")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("array1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// expected output: 10")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 5 + 1 + 2 + 3 + 4")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("array1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// expected output: 15")]),t._v("\n")])])]),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("arg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'f1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" arg\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("arg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'f2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" arg\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("arg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'f3'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" arg\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("f3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"omg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'res'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// f3, omg")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// f2, omg")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// f1, omg")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// res, omg")]),t._v("\n")])])]),s("p",[t._v("但是这样嵌套写法，在实际代码书写中，会很复杂，书写不够优雅")]),t._v(" "),s("p",[t._v("有没有一个函数能让我这样调用，即传入函数，让它自动执行")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" f2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" f3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"omg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("方法：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("funcs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("funcs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("args")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" args\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("funcs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" funcs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" funcs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("a")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("b")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"redux-上手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redux-上手"}},[t._v("#")]),t._v(" Redux 上手")]),t._v(" "),s("p",[t._v("Redux 是 JavaScript 应用的状态容器。它保证程序行为一致性且易于测试")]),t._v(" "),s("h3",{attrs:{id:"手写redux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手写redux"}},[t._v("#")]),t._v(" 手写redux")]),t._v(" "),s("p",[t._v("累加器例子：")]),t._v(" "),s("ol",[s("li",[t._v("需要一个 store 来存储数据")]),t._v(" "),s("li",[t._v("store 里的 reducer 初始化 state 并"),s("strong",[t._v("定义 state 修改规则")])]),t._v(" "),s("li",[t._v("通过 dispatch 一个 action 来提交对数据的修改")]),t._v(" "),s("li",[t._v("action 提交到 reducer 函数里，根据传入的 action 的 type，返回新的 state")])]),t._v(" "),s("p",[t._v("实现combineReducers，combineReducers就是把所有的reducer合并成一个reducer")]),t._v(" "),s("p",[t._v("reducer可以按页面（组件）来划分规则，然后最后合在一起")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("todoRender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("combineReducers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("reducers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("combination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" hasChanged "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" reducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reducer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reducers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            nextState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reducer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            hasChanged "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hasChanged "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" nextState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        hasChanged "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hasChanged "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" Object"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" hasChanged "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" nextState "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" state\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"手写redux-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手写redux-2"}},[t._v("#")]),t._v(" 手写Redux")]),t._v(" "),s("h3",{attrs:{id:"middleware"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#middleware"}},[t._v("#")]),t._v(" middleware")]),t._v(" "),s("p",[t._v("它提供的是位于 action 被发起之后，到达 reducer 之前的扩展点")]),t._v(" "),s("p",[t._v("const next = store.dispatch;")]),t._v(" "),s("p",[t._v("通过 context来传递数据")]),t._v(" "),s("p",[t._v("与 react-router 一样")]),t._v(" "),s("p",[t._v("https://zhuanlan.zhihu.com/p/410648220?utm_source=wechat_session&utm_medium=social&utm_oi=56197411504128")]),t._v(" "),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzA4Nzg0MDM5Nw==&mid=2247484475&idx=1&sn=27575ab8a8ad4e5e78cec8c2bcad4b0c&source=41#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t._v("从零开始实现一个 Redux，知其然并知其所以然"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://github.com/ykforerlang/tinyredux",target:"_blank",rel:"noopener noreferrer"}},[t._v("从0实现一个tinyredux"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/bJizhO3eP7db22YdzF0fOQ",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redux 设计思想与工作原理"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN：reduce"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=e.exports}}]);