(window.webpackJsonp=window.webpackJsonp||[]).push([[237],{693:function(s,t,a){"use strict";a.r(t);var e=a(25),v=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"实战-李瓶儿博客开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战-李瓶儿博客开发"}},[s._v("#")]),s._v(" 实战：李瓶儿博客开发")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/06/03/TzJV3jixZlL4NdW.png",alt:"TIM截图20200123173701"}})]),s._v(" "),a("h3",{attrs:{id:"http-请求概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-请求概述"}},[s._v("#")]),s._v(" http 请求概述")]),s._v(" "),a("p",[s._v("从输入url到页面显示中间发生了什么")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("DNS 解析，建立TCP连接，发送http请求")])]),s._v(" "),a("li",[a("p",[s._v("server 接收到 http 请求，处理，并返回")])]),s._v(" "),a("li",[a("p",[s._v("客户端接收到返回数据，处理数据（如渲染页面，执行js）")])])]),s._v(" "),a("p",[s._v("nodejs 处理 http 请求")]),s._v(" "),a("ul",[a("li",[s._v("get 请求和 querystring")]),s._v(" "),a("li",[s._v("post请求和postdata")]),s._v(" "),a("li",[s._v("路由")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/06/03/WJGHqvZMAtyapSf.png",alt:"TIM截图20200123223412"}})]),s._v(" "),a("h3",{attrs:{id:"mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[s._v("#")]),s._v(" MySQL")]),s._v(" "),a("ul",[a("li",[s._v("mysql介紹、安裝和使用")]),s._v(" "),a("li",[s._v("nodejs连接mysql")]),s._v(" "),a("li",[s._v("API连接mysql")])]),s._v(" "),a("p",[s._v("为什么使用mysql而不是mogondb")]),s._v(" "),a("ul",[a("li",[s._v("mysql是企业内最常见的存储工具，一般都有专人运维")]),s._v(" "),a("li",[s._v("mysql也是社区内最常用的存储工具，有问题可以随时可查")]),s._v(" "),a("li",[s._v("另：mysql本身是一个复杂的数据库软件，本课只讲基本使用")])]),s._v(" "),a("h4",{attrs:{id:"mysql介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql介绍"}},[s._v("#")]),s._v(" mysql介绍")]),s._v(" "),a("ul",[a("li",[s._v("web server 中最流行的关系型数据库")]),s._v(" "),a("li",[s._v("官网可免费下载，用于学习")]),s._v(" "),a("li",[s._v("轻量级，易学易用")])]),s._v(" "),a("p",[s._v("mysql workbench 可视化数据库")]),s._v(" "),a("p",[s._v("mysql命令")]),s._v(" "),a("p",[s._v("show databases 显示所有的数据库表")]),s._v(" "),a("h3",{attrs:{id:"mysql安装步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql安装步骤"}},[s._v("#")]),s._v(" mysql安装步骤")]),s._v(" "),a("p",[s._v("https://zhuanlan.zhihu.com/p/37152572")]),s._v(" "),a("h3",{attrs:{id:"操作数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作数据库"}},[s._v("#")]),s._v(" 操作数据库")]),s._v(" "),a("ul",[a("li",[a("h5",{attrs:{id:"建库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建库"}},[s._v("#")]),s._v(" 建库")])]),s._v(" "),a("li",[a("h5",{attrs:{id:"建表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建表"}},[s._v("#")]),s._v(" 建表")])]),s._v(" "),a("li",[a("h5",{attrs:{id:"表操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表操作"}},[s._v("#")]),s._v(" 表操作")])])]),s._v(" "),a("p",[s._v("操作表")]),s._v(" "),a("p",[a("strong",[s._v("增、删、改、查")])]),s._v(" "),a("p",[s._v("使用sql语句（入门简单，一学就会）")]),s._v(" "),a("p",[s._v("增")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("insert into users(username, `password`, realname) values('lisi', '123', '李四')\n")])])]),a("p",[s._v("查")]),s._v(" "),a("p",[s._v("查users表所有信息")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users;\n")])])]),a("p",[s._v("查users表中其中id和username的信息")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select id, username from users;\n")])])]),a("p",[s._v("查符合条件的项 where")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username='zhangsan'\n")])])]),a("p",[s._v("查符合条件的项多个条件 "),a("code",[s._v("and")]),s._v(" 和 "),a("code",[s._v("or")])]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username='zhangsan' and realname='111'\n")])])]),a("p",[s._v("模糊查询 "),a("code",[s._v("like")])]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username like '%zhang%'\n")])])]),a("p",[s._v("查 排序 "),a("code",[s._v("order by id")]),s._v(" 默认正序，如果倒序 在id后加 desc "),a("code",[s._v("order by id desc")])]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from users where username like '%zhang%' order by id desc;\n")])])]),a("p",[s._v("ps：一般不用 * ，耗性能")]),s._v(" "),a("p",[s._v("改")]),s._v(" "),a("p",[s._v("更新 id为3的realname为张三")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("update users set realname='张三' where id='3'\n")])])]),a("p",[s._v("删")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("delete from users where realname='李四'\n")])])]),a("p",[s._v("但一般来说不用delete，二是在users表中加一个状态，通过状态来判断他是否被删除。这种技术又称软删除")]),s._v(" "),a("p",[s._v("PS:如果你的更新和删除出现 error：1175处于安全模式，先使用以下代码解除安全模式")]),s._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SET SQL_SAFE_UPDATES=0;\n")])])]),a("h3",{attrs:{id:"登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[s._v("#")]),s._v(" 登录")]),s._v(" "),a("ul",[a("li",[s._v("cookie 和 session")]),s._v(" "),a("li",[s._v("session 写入 redis")]),s._v(" "),a("li",[s._v("开发登录功能，和前端联调（用到 nginx 反向代理）")])]),s._v(" "),a("h4",{attrs:{id:"cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[s._v("#")]),s._v(" cookie")]),s._v(" "),a("ul",[a("li",[s._v("什么是cookie")]),s._v(" "),a("li",[s._v("javascript 操作 cookie，浏览器中查找 cookie")]),s._v(" "),a("li",[s._v("server 端操作 cookie，实现登录验证")])]),s._v(" "),a("p",[s._v("什么是cookie？")]),s._v(" "),a("ul",[a("li",[s._v("存储在浏览器中的一段字符串（最大4KB）")]),s._v(" "),a("li",[s._v("跨域不共享")]),s._v(" "),a("li",[s._v("格式如 k1=v1；k2=v2；k3=v3；因此可以存储结构化数据")]),s._v(" "),a("li",[s._v("特点一：每次发送http请求，会将请求域的 cookie 一起发送给 server")]),s._v(" "),a("li",[s._v("特点二：server 可以修改 cookie 并返回给浏览器")]),s._v(" "),a("li",[s._v("特点三：浏览器中也可以通过 javascript 修改 cookie （有限制）")])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Set-Cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("username=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("; path=/; httpOnly; expires=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCookieExpires")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("path：根域名下cookie共享")]),s._v(" "),a("p",[s._v("httpOnly：只能服务器修改，浏览器不能修改")]),s._v(" "),a("p",[s._v("expires：设置过期时间")]),s._v(" "),a("h4",{attrs:{id:"session"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[s._v("#")]),s._v(" session")]),s._v(" "),a("p",[s._v("cookie的缺点，会暴露username，很危险，不安全")]),s._v(" "),a("p",[s._v("cookie可以存储userid，server端对应username")]),s._v(" "),a("p",[s._v("cookie 放不重要的数据，放userid（一个标识）对应server端的username")]),s._v(" "),a("p",[s._v("就能做到数据的保密")]),s._v(" "),a("p",[s._v("解决方案：session，即 server 端存储用户信息")]),s._v(" "),a("h4",{attrs:{id:"session造成的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#session造成的问题"}},[s._v("#")]),s._v(" session造成的问题")]),s._v(" "),a("p",[s._v("目前session直接是js变量，放在 nodejs 进程内存中")]),s._v(" "),a("p",[s._v("第一，进程内存有限，访问量过大，内存暴增怎么办？")]),s._v(" "),a("p",[s._v("第二，正式线上运行是多线程，进程之间内存无法共享")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/06/03/6S8tiBYEocybL4w.png",alt:"TIM截图20200206165902"}})]),s._v(" "),a("p",[s._v("系统内存之间有多个线程，线程之间不共享内存")]),s._v(" "),a("h4",{attrs:{id:"解决方案-redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-redis"}},[s._v("#")]),s._v(" 解决方案 redis")]),s._v(" "),a("ul",[a("li",[s._v("web server 最常用的缓存数据库，数据库放在内存中")]),s._v(" "),a("li",[s._v("相比于 mysql，访问速度快（内存和硬盘不是一个数量级的）")]),s._v(" "),a("li",[s._v("但是成本更高，可存储的数量更小（内存硬伤）")])]),s._v(" "),a("p",[s._v("如果解决")]),s._v(" "),a("ul",[a("li",[s._v("将 web server 和 redis 拆分为两个独立的服务")]),s._v(" "),a("li",[s._v("双方都是独立的，都是可扩展的（例如都扩展成集群）")]),s._v(" "),a("li",[s._v("（包括mysql，也是一个单独的服务，可扩展）")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/06/03/OojsGEuLMgWACZJ.png",alt:"TIM截图20200206170732"}})]),s._v(" "),a("p",[s._v("登录等数据放在redis，数据有关的放在mysql，都是相对独立的服务")]),s._v(" "),a("p",[s._v("数据分离，可以扩展")]),s._v(" "),a("h4",{attrs:{id:"为什么session适合用redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么session适合用redis"}},[s._v("#")]),s._v(" 为什么session适合用redis？")]),s._v(" "),a("ul",[a("li",[s._v("session 访问频繁，对性能要求高（redis内存数据库，速度快）")]),s._v(" "),a("li",[s._v("session 可不考虑断电丢失数据的问题（内存的硬伤）")]),s._v(" "),a("li",[s._v("session 数据量不会太大（内存小，相比mysql中的数据小的多）")])]),s._v(" "),a("h4",{attrs:{id:"安装redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装redis"}},[s._v("#")]),s._v(" 安装redis")]),s._v(" "),a("p",[s._v("https://www.runoob.com/redis/redis-install.html")]),s._v(" "),a("p",[s._v("启动redis")]),s._v(" "),a("p",[a("code",[s._v("redis-server")]),s._v(" ,要一直连接状态（服务在线）")]),s._v(" "),a("p",[s._v("在命令行中敲 "),a("code",[s._v("redis-cli")]),s._v("，进入redis操作中")]),s._v(" "),a("h4",{attrs:{id:"常见的redis操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的redis操作"}},[s._v("#")]),s._v(" 常见的redis操作")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("命令")]),s._v(" "),a("th",[s._v("解释")]),s._v(" "),a("th",[s._v("例子")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("set key value")]),s._v(" "),a("td",[s._v("设置key")]),s._v(" "),a("td",[s._v("set myname hanbo")])]),s._v(" "),a("tr",[a("td",[s._v("get key")]),s._v(" "),a("td",[s._v("得到key")]),s._v(" "),a("td",[s._v("get myname")])]),s._v(" "),a("tr",[a("td",[s._v("del key")]),s._v(" "),a("td",[s._v("删除key")]),s._v(" "),a("td",[s._v("del myname")])]),s._v(" "),a("tr",[a("td",[s._v("keys *")]),s._v(" "),a("td",[s._v("显示所有的key")]),s._v(" "),a("td",[s._v("keys *")])])])]),s._v(" "),a("p",[s._v("为何要用redis？不用redis会出现什么问题？")]),s._v(" "),a("p",[s._v("redis适合什么场景？mysql适合什么场景？")]),s._v(" "),a("p",[s._v("要保存状态机，如果你要一直保存登录状态，就要从内存中读取数据，而不是去请求数据库")]),s._v(" "),a("p",[s._v("请求数据库需要花时间，")]),s._v(" "),a("p",[s._v("redis适合登录 状态这种情况")]),s._v(" "),a("h4",{attrs:{id:"与前端联调"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#与前端联调"}},[s._v("#")]),s._v(" 与前端联调")]),s._v(" "),a("ul",[a("li",[s._v("登录功能依赖 cookie ，必须用浏览器来联调")]),s._v(" "),a("li",[s._v("cookie 跨域不共享，前端和 server 端必须同域")]),s._v(" "),a("li",[s._v("需要用到 nginx 做代理，让前后端同域")])]),s._v(" "),a("p",[s._v("使用nginx 反向代理请求")]),s._v(" "),a("h4",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" nginx")]),s._v(" "),a("ul",[a("li",[s._v("高性能的 web 服务器，开源免费")]),s._v(" "),a("li",[s._v("一般用于做静态服务、负载均衡")]),s._v(" "),a("li",[s._v("反向代理")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/06/03/qoZFE1t8fvy6rKD.png",alt:"TIM截图20200207152320"}})]),s._v(" "),a("h2",{attrs:{id:"日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[s._v("#")]),s._v(" 日志")]),s._v(" "),a("ul",[a("li",[s._v("系统没有日志，就等于人没有眼睛——抓瞎")]),s._v(" "),a("li",[s._v("第一，访问日志 access log （server 端最重要的日志）")]),s._v(" "),a("li",[s._v("第二，自定义日志（包括自定义事件、错误记录等）")])]),s._v(" "),a("h4",{attrs:{id:"目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),a("ul",[a("li",[s._v("nodejs 文件操作，nodejs stream")]),s._v(" "),a("li",[s._v("日志功能开发和使用")]),s._v(" "),a("li",[s._v("日志文件拆分，日志内容分析")])]),s._v(" "),a("h4",{attrs:{id:"nodejs文件操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs文件操作"}},[s._v("#")]),s._v(" nodejs文件操作")]),s._v(" "),a("ul",[a("li",[s._v("日志要存放到文件中")]),s._v(" "),a("li",[s._v("为何不存储到 mysql 中？")]),s._v(" "),a("li",[s._v("为何不存储到 redis 中？")])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" fileName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 读取文件内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// fs.readFile(fileName, (err, data) => {")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   if (err) {")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//     console.log(err)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//     return;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   }")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   console.log(data.toString())")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// })")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 写入文件内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// const content = '这是新写入的内容\\n';")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// const opt = {")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   flag: 'a'   // 追加写入。覆盖用'w'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// }")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// fs.writeFile(fileName, content, opt, (err) => {")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   if (err) {")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//     console.log(err)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   }")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// })")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断文件是否存在")]),s._v("\nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exists")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("exist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'exist'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" exist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n")])])]),a("h4",{attrs:{id:"io操作的性能瓶颈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#io操作的性能瓶颈"}},[s._v("#")]),s._v(" IO操作的性能瓶颈")]),s._v(" "),a("ul",[a("li",[s._v("IO包括”网络IO”和“文件IO”")]),s._v(" "),a("li",[s._v("相比于 CPU 计算和内存读写， IO 的突出特点就是：慢！")]),s._v(" "),a("li",[s._v("如何在有限的硬件资源下提高 IO 的操作效率？")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/06/03/bl2kaADutYdqGzH.png",alt:"TIM截图20200214145700"}})]),s._v(" "),a("p",[s._v("stream 流，一点点流过去，一点点读取")]),s._v(" "),a("h4",{attrs:{id:"日志分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志分析"}},[s._v("#")]),s._v(" 日志分析")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("如针对 access.log 日志，分析 chrome 的占比")])]),s._v(" "),a("li",[a("p",[s._v("日志是按行存储的，一行就是一条日志")])]),s._v(" "),a("li",[a("p",[s._v("使用 nodejs 的 readline（基于 stream ，效率高）")])])]),s._v(" "),a("p",[s._v("readline 可以分析 数据，做数据统计用")]),s._v(" "),a("h3",{attrs:{id:"安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全"}},[s._v("#")]),s._v(" 安全")]),s._v(" "),a("ul",[a("li",[s._v("sql 注入：窃取数据库内容")]),s._v(" "),a("li",[s._v("XSS 攻击：窃取前端的 cookie 内容")]),s._v(" "),a("li",[s._v("密码加密：保障用户信息安全（重要！）加盐")])]),s._v(" "),a("h4",{attrs:{id:"sql-注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql-注入"}},[s._v("#")]),s._v(" sql 注入")]),s._v(" "),a("ul",[a("li",[s._v("最原始、最简单的攻击，从有了 web2.0 就有了 sql 注入攻击")]),s._v(" "),a("li",[s._v("攻击方式：输入一个 sql 片段，最终拼接成一段攻击代码")]),s._v(" "),a("li",[s._v("预防措施：使用 mysql 的 escape 函数处理输入内容即可")])]),s._v(" "),a("h4",{attrs:{id:"xss-攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击"}},[s._v("#")]),s._v(" XSS 攻击")]),s._v(" "),a("ul",[a("li",[s._v("前端最熟悉的攻击方式， 方式 server 端更应该掌握")]),s._v(" "),a("li",[s._v("攻击方式：在页面展示内容中掺杂 js 代码，以获得网页信息")]),s._v(" "),a("li",[s._v("预防措施： 转换生成 js 的特殊字符")])]),s._v(" "),a("h4",{attrs:{id:"密码加密"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#密码加密"}},[s._v("#")]),s._v(" 密码加密")]),s._v(" "),a("ul",[a("li",[s._v("万一数据库被用户攻破，最不应该泄露的就是用户信息")]),s._v(" "),a("li",[s._v("攻击方式：获取用户名和密码，再去尝试登录其他系统")]),s._v(" "),a("li",[s._v("预防措施：将密码加密，即便拿到密码也不知道明文")])]),s._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结：")]),s._v(" "),a("h4",{attrs:{id:"功能模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能模块"}},[s._v("#")]),s._v(" 功能模块")]),s._v(" "),a("ul",[a("li",[s._v("处理 http 接口")]),s._v(" "),a("li",[s._v("连接数据库")]),s._v(" "),a("li",[s._v("实现登录")]),s._v(" "),a("li",[s._v("安全")]),s._v(" "),a("li",[s._v("日志")]),s._v(" "),a("li",[s._v("上线")])]),s._v(" "),a("h4",{attrs:{id:"核心知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心知识"}},[s._v("#")]),s._v(" 核心知识")]),s._v(" "),a("ul",[a("li",[s._v("http，nodejs 处理 http、处理路由、mysql")]),s._v(" "),a("li",[s._v("cookie，session，redis，nginx做反向代理")]),s._v(" "),a("li",[s._v("sql注入，xss 攻击，加密")]),s._v(" "),a("li",[s._v("日志，stream，contrab，readline")]),s._v(" "),a("li",[s._v("线上环境的知识")])]),s._v(" "),a("h2",{attrs:{id:"使用express来开发web-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用express来开发web-server"}},[s._v("#")]),s._v(" 使用express来开发web server")]),s._v(" "),a("p",[s._v("express.json() \t解析post请求")]),s._v(" "),a("h4",{attrs:{id:"中间件机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间件机制"}},[s._v("#")]),s._v(" 中间件机制")]),s._v(" "),a("ul",[a("li",[s._v("有很多 app.use")]),s._v(" "),a("li",[s._v("代码中的 next 参数是什么？")]),s._v(" "),a("li",[s._v("带着这些疑问，先看一段代码演示")])]),s._v(" "),a("h4",{attrs:{id:"express-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express-总结"}},[s._v("#")]),s._v(" express 总结")]),s._v(" "),a("h4",{attrs:{id:"中间件原理介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间件原理介绍"}},[s._v("#")]),s._v(" 中间件原理介绍")]),s._v(" "),a("h5",{attrs:{id:"分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[s._v("#")]),s._v(" 分析")]),s._v(" "),a("ul",[a("li",[s._v("app.use 用来注册中间件，先收集起")]),s._v(" "),a("li",[s._v("遇到 http 请求，根据 path 和 method 判断触发哪些")]),s._v(" "),a("li",[s._v("实现 next 机制，即上一个通过 next 触发下一个")])]),s._v(" "),a("h3",{attrs:{id:"使用-koa2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-koa2"}},[s._v("#")]),s._v(" 使用 Koa2")]),s._v(" "),a("ul",[a("li",[s._v("express 中间件是异步回调，koa2原生支持 async/await")]),s._v(" "),a("li",[s._v("新开发框架和系统，都开始基于 koa2，例如 egg.js")]),s._v(" "),a("li",[s._v("express 虽然未过时，但是 koa2 肯定是未来趋势")])]),s._v(" "),a("h4",{attrs:{id:"目录-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录-2"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),a("ul",[a("li",[s._v("async/await 语法介绍，安装和使用 koa2")]),s._v(" "),a("li",[s._v("开发接口，链接数据库，实现登录，日志记录")]),s._v(" "),a("li",[s._v("分析 koa2 中间件原理")])]),s._v(" "),a("h4",{attrs:{id:"async-await要点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#async-await要点"}},[s._v("#")]),s._v(" async await要点：")]),s._v(" "),a("ol",[a("li",[s._v("await 后面可以追加 promise 对象，获取 resolve 的值")]),s._v(" "),a("li",[s._v("await 必须包裹在 async 函数里面")]),s._v(" "),a("li",[s._v("async 函数执行返回的也是一个 promise 对象")]),s._v(" "),a("li",[s._v("try-catch 截获 promise 中 reject 的值")])]),s._v(" "),a("h4",{attrs:{id:"中间件机制-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间件机制-2"}},[s._v("#")]),s._v(" 中间件机制")]),s._v(" "),a("ul",[a("li",[s._v("有很多 app.use")]),s._v(" "),a("li",[s._v("代码中的 next 参数是什么？")])]),s._v(" "),a("p",[s._v("app.use 和 express一致，使用中间件")]),s._v(" "),a("p",[s._v("洋葱模型")]),s._v(" "),a("h4",{attrs:{id:"实现登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现登录"}},[s._v("#")]),s._v(" 实现登录")]),s._v(" "),a("ul",[a("li",[s._v("和 express 类似")]),s._v(" "),a("li",[s._v("基于 koa-generic-session 和 koa-redis")])]),s._v(" "),a("h4",{attrs:{id:"线上环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#线上环境"}},[s._v("#")]),s._v(" 线上环境")]),s._v(" "),a("ul",[a("li",[s._v("服务器稳定性")]),s._v(" "),a("li",[s._v("重温利用服务器硬件资源，以便提高性能")]),s._v(" "),a("li",[s._v("线上日志记录")])]),s._v(" "),a("h4",{attrs:{id:"pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[s._v("#")]),s._v(" PM2")]),s._v(" "),a("ul",[a("li",[s._v("进程守护，系统奔溃自动重启")]),s._v(" "),a("li",[s._v("启动多进程，充分利用CPU和内存")]),s._v(" "),a("li",[s._v("自带日志记录功能")])]),s._v(" "),a("h4",{attrs:{id:"pm2介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2介绍"}},[s._v("#")]),s._v(" PM2介绍")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("下载安装")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("npm install pm2 -g")])]),s._v(" "),a("li",[a("code",[s._v("pm2 --version")])])])]),s._v(" "),a("li",[a("p",[s._v("基本使用")])]),s._v(" "),a("li",[a("p",[s._v("常用命令")]),s._v(" "),a("p",[a("code",[s._v("pm2 start [app.js]")]),s._v(" 启动")]),s._v(" "),a("p",[a("code",[s._v("pm2 restart [app.js]")]),s._v(" 重启")]),s._v(" "),a("p",[a("code",[s._v("pm2 stop [app.js]")]),s._v(" 停止")]),s._v(" "),a("p",[a("code",[s._v("pm2 list")]),s._v(" 查看启动列表")]),s._v(" "),a("p",[a("code",[s._v("pm2 info <AppName>/<id>")]),s._v("查看基本信息")]),s._v(" "),a("p",[a("code",[s._v("pm2 log <AppName>/<id>")]),s._v(" 查看日志打印")]),s._v(" "),a("p",[a("code",[s._v("pm2 monit <AppName>/<id>")]),s._v("监控这个进程的CPU和内存信息")])])]),s._v(" "),a("h4",{attrs:{id:"pm2进程守护"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2进程守护"}},[s._v("#")]),s._v(" PM2进程守护")]),s._v(" "),a("h3",{attrs:{id:"课程总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#课程总结"}},[s._v("#")]),s._v(" 课程总结")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2021/06/03/lMGSgBwmDiUzrTP.png",alt:"课程总结"}})])])}),[],!1,null,null,null);t.default=v.exports}}]);