(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{455:function(a,t,e){a.exports=e.p+"assets/img/监听点击事件.f76b8373.png"},827:function(a,t,e){"use strict";e.r(t);var s=e(25),_=Object(s.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"微信服务端开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信服务端开发"}},[a._v("#")]),a._v(" 微信服务端开发")]),a._v(" "),s("blockquote",[s("p",[a._v("这里的笔记比较杂")])]),a._v(" "),s("p",[a._v("起服务，例如用 Koa 起个服务，后端请求微信提供的方法...")]),a._v(" "),s("h2",{attrs:{id:"什么是-access-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-access-token"}},[a._v("#")]),a._v(" 什么是 access_token")]),a._v(" "),s("blockquote",[s("p",[a._v("access_token 是公众号的全局唯一票据，公众号调用各接口时都需使用access_token。有效期为2小时，且一天最多只能调用2000次")])]),a._v(" "),s("p",[a._v("这样的话，access_token 必须缓存起来（不然它只有2000次调用）")]),a._v(" "),s("p",[a._v("我们定时每1个小时刷新一次，一天也就调用24次，搓搓有余了")]),a._v(" "),s("p",[a._v("思路是这样，调用XX方法，如果有缓存，用缓存的；如果没有，去调用接口")]),a._v(" "),s("p",[a._v("做法：每一个小时去调用一次接口")]),a._v(" "),s("h2",{attrs:{id:"什么是-jsapi-ticket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-jsapi-ticket"}},[a._v("#")]),a._v(" 什么是 jsapi_ticket")]),a._v(" "),s("p",[a._v("jsapi_ticket 是公众号用于调用微信JS接口的临时票据。一般为2小时，通过access_token获取。")]),a._v(" "),s("p",[a._v("无论是 access_token 还是 jsapi_ticket ，都需要进行缓存")]),a._v(" "),s("h2",{attrs:{id:"如何监听消息管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何监听消息管理"}},[a._v("#")]),a._v(" 如何监听消息管理？")]),a._v(" "),s("p",[a._v("如何监听自定义菜单的点击事件？")]),a._v(" "),s("p",[s("img",{attrs:{src:e(455),alt:"1597714990796"}})]),a._v(" "),s("p",[a._v("需要配置“接口配置信息”，这个配通了，就是说，微信会发消息给你")]),a._v(" "),s("p",[a._v("但是因为翻墙的原因，本机的ip获取不到，只能通过内网穿透来实现，找了natappfree来实现")]),a._v(" "),s("p",[a._v("使用 "),s("code",[a._v("koa-xml-body")]),a._v(" 来解析 xml 格式文件")]),a._v(" "),s("p",[a._v("但是需要注意的是，"),s("code",[a._v("app.use(xmlParser());")]),a._v("  要放在 "),s("code",[a._v("app.use(bodyParser());")]),a._v(" 前面")]),a._v(" "),s("h2",{attrs:{id:"内网穿透"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内网穿透"}},[a._v("#")]),a._v(" 内网穿透")]),a._v(" "),s("p",[a._v("为了在本机调试，需要内网穿透，本来用 natapp，但是偶尔会连接不上，又查了查，找到最好的内网穿透的工具："),s("strong",[a._v("ngrok")])]),a._v(" "),s("h2",{attrs:{id:"关于media-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于media-id"}},[a._v("#")]),a._v(" 关于media_id")]),a._v(" "),s("p",[a._v("想在公众号里回复图片，视频或者图文，就要有media_id。找了半圈，新增临时素材能获取media_id。有效期是3天")]),a._v(" "),s("h3",{attrs:{id:"坑点-axios请求怎么样也上传不了照片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#坑点-axios请求怎么样也上传不了照片"}},[a._v("#")]),a._v(" 坑点：axios请求怎么样也上传不了照片")]),a._v(" "),s("p",[a._v("这里的常见错误："),s("a",{attrs:{href:"https://developers.weixin.qq.com/community/develop/doc/00000ef32dc64883d9d93f31f56800",target:"_blank",rel:"noopener noreferrer"}},[a._v("公众号开发 调用【上传图文消息内的图片获取URL】接口时，返回 412 错误？"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"坑点2-微信测试号不能上传-永久media-id-但是文档没写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#坑点2-微信测试号不能上传-永久media-id-但是文档没写"}},[a._v("#")]),a._v(" 坑点2：微信测试号不能上传 永久media_id，但是文档没写")]),a._v(" "),s("p",[a._v("永久素材可以一般要在有素材内容的公众号里直接拿过来")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://segmentfault.com/q/1010000012972666",target:"_blank",rel:"noopener noreferrer"}},[a._v("微信公众号上传的永久素材得到的media_id无效"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"如何让在koa中使用redis-让redis-同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何让在koa中使用redis-让redis-同步"}},[a._v("#")]),a._v(" 如何让在koa中使用redis ，让redis 同步")]),a._v(" "),s("p",[a._v("加入一个库 async-redis")]),a._v(" "),s("p",[a._v("让它支持异步")]),a._v(" "),s("h2",{attrs:{id:"定时功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定时功能"}},[a._v("#")]),a._v(" 定时功能")]),a._v(" "),s("p",[a._v("定时 node-schedule 接入，每一小时定时获取 access_token")])])}),[],!1,null,null,null);t.default=_.exports}}]);