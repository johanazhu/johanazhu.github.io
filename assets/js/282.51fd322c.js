(window.webpackJsonp=window.webpackJsonp||[]).push([[282],{740:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"页面渲染层面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#页面渲染层面"}},[t._v("#")]),t._v(" 页面渲染层面")]),t._v(" "),a("p",[t._v("html dom树，css cssom树 defer async等等 遇到js，preload以及 prefetch 并发加载\n重绘和回流\n浏览器缓存")]),t._v(" "),a("p",[t._v("页面渲染阶段")]),t._v(" "),a("ul",[a("li",[t._v("css在上、js在下")]),t._v(" "),a("li",[t._v("加载css推荐用link少用 @import\n"),a("ul",[a("li",[t._v("link 属于 html，@import 属于 css，需写在样式表开头")]),t._v(" "),a("li",[t._v("@import 是 css2.1 才出现的概念")]),t._v(" "),a("li",[t._v("当 html 文件被加载时，link 引用的文件会同时被加载，而@import 引用的文件则会等页面全部下载完毕再被加载")])])]),t._v(" "),a("li",[t._v("不重要的外置引入的js使用defer或者async属性异步加载")])]),t._v(" "),a("p",[a("code",[t._v("script")]),t._v(" 特性（attribute）可以为我们解决延迟问题："),a("code",[t._v("defer")]),t._v(" 和 "),a("code",[t._v("async")])]),t._v(" "),a("h3",{attrs:{id:"defer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#defer"}},[t._v("#")]),t._v(" defer")]),t._v(" "),a("p",[a("code",[t._v("defer")]),t._v(" 特性告诉浏览器不要等待脚本。相反，浏览器将继续处理HTML，构建 DOM。脚本会“在后台”下载，然后等 DOM 构建完成后，脚本才会执行")]),t._v(" "),a("p",[t._v("换句话说：")]),t._v(" "),a("ul",[a("li",[t._v("具有 "),a("code",[t._v("defer")]),t._v(" 特性的脚本不会阻塞页面")]),t._v(" "),a("li",[t._v("具有 "),a("code",[t._v("defer")]),t._v(" 特性的脚本总是要等到 DOM 解析完毕，但在 "),a("code",[t._v("DOMContentLoaded")]),t._v(" 事件之前执行")])]),t._v(" "),a("p",[t._v("下面这个示例演示了上面所说的第二句话：")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("...content before scripts..."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DOMContentLoaded'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOM ready after defer!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("defer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://javascript.info/article/script-async-defer/long.js?speed=1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("...content after scripts..."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("ol",[a("li",[t._v("页面内容立即现实")]),t._v(" "),a("li",[a("code",[t._v("DOMContentLoaded")]),t._v(" 事件处理程序等待具有"),a("code",[t._v("defer")]),t._v(" 特性的脚本执行完成。它仅在脚本下载且执行结束后才会被触发")])]),t._v(" "),a("p",[a("strong",[t._v("具有 "),a("code",[t._v("defer")]),t._v(" 特性的脚本保持其相对顺序，就像常规脚本一样。")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("defer")]),t._v(" 特性仅适用于外部脚本")])]),t._v(" "),a("p",[t._v("如果 "),a("code",[t._v("<script>")]),t._v(" 脚本没有 "),a("code",[t._v("src")]),t._v("，则会忽略 "),a("code",[t._v("defer")]),t._v(" 特性。")]),t._v(" "),a("h3",{attrs:{id:"async"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#async"}},[t._v("#")]),t._v(" async")]),t._v(" "),a("p",[a("code",[t._v("async")]),t._v(" 特性与 "),a("code",[t._v("defer")]),t._v(" 有些类似。它也能够让脚本不阻塞页面，但是，在行为上二者有着重要的区别")]),t._v(" "),a("p",[a("code",[t._v("async")]),t._v(" 特性意味着脚本是完成独立的")]),t._v(" "),a("ul",[a("li",[t._v("浏览器不会因 "),a("code",[t._v("async")]),t._v(" 脚本而阻塞（与 "),a("code",[t._v("defer")]),t._v(" 类似）")]),t._v(" "),a("li",[t._v("其他脚本不会等待 "),a("code",[t._v("async")]),t._v(" 脚本加载完成，同样，"),a("code",[t._v("async")]),t._v(" 脚本也不会等待其他脚本")]),t._v(" "),a("li",[a("code",[t._v("DOMContentLoaded")]),t._v(" 可能会发生在异步脚本之前（如果异步脚本在页面完成后才加载完成）")]),t._v(" "),a("li",[a("code",[t._v("DOMContentLoaded")]),t._v(" 也可能发生在异步脚本之后（如果异步脚本很短，或者是从 HTTP 缓存中加载的）")])]),t._v(" "),a("p",[t._v("换句话说，"),a("code",[t._v("async")]),t._v(" 脚本会在后台加载，并在加载就绪时运行。DOM和其他脚本不会等待它们，它们也不会等待其他的东西。"),a("code",[t._v("async")]),t._v(" 脚本就是一个会在加载完成时执行的完全独立的脚本")]),t._v(" "),a("h3",{attrs:{id:"动态脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态脚本"}},[t._v("#")]),t._v(" 动态脚本")]),t._v(" "),a("p",[t._v("我们可以使用 JavaScript 动态地创建一个脚本，并将其插入（append）到文档（document）中：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nscript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/article/script-async-defer/long.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// (*)")]),t._v("\n")])])]),a("p",[a("strong",[t._v("默认情况下，动态脚本的行为是“异步”的。")])]),t._v(" "),a("p",[t._v("也就是说：")]),t._v(" "),a("ul",[a("li",[t._v("它们不会等待任何东西，也没有上面东西会等它们")]),t._v(" "),a("li",[t._v("先加载完成的脚本先执行（“加载优先”顺序）")])]),t._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[a("code",[t._v("async")]),t._v(" 和 "),a("code",[t._v("defer")]),t._v(" 有一个共同点：加载这样的脚本都不会阻塞页面的渲染。因此，用户可以立即圆度并了解页面内容。但是，它们之前也存在一些本质的区别：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("顺序")]),t._v(" "),a("th",[t._v("DOMContnetLoaded")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("async")]),t._v(" "),a("td",[t._v("加载优先顺序。脚本在文档中的顺序不重要——先加载完成的先执行")]),t._v(" "),a("td",[t._v("不相关。可能在文档加载完成前加载并执行完毕。如果脚本很小或者来自缓存，同时文档足够长，就会发生这种情况")])]),t._v(" "),a("tr",[a("td",[t._v("defer")]),t._v(" "),a("td",[t._v("文档顺序（它们在文档中的顺序）")]),t._v(" "),a("td",[t._v("在文档加载和解析完成之后（如果需要，则会等待），即在"),a("code",[t._v("DOMContentLoaded")]),t._v(" 之前执行")])])])]),t._v(" "),a("p",[t._v("在实际开发中，"),a("code",[t._v("defer")]),t._v(" 用于需要整个 DOM 的脚本，脚本的相对执行顺序很重要的时候使用")]),t._v(" "),a("p",[a("code",[t._v("async")]),t._v(" 用于独立脚本，例如计数器或广告，这些脚本的相对执行顺序无关紧要")]),t._v(" "),a("h3",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://zh.javascript.info/script-async-defer",target:"_blank",rel:"noopener noreferrer"}},[t._v("脚本：async，defer"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);